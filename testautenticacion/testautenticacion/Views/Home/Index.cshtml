@model testautenticacion.Models.Emergencia

@{
    ViewBag.Title = "Home Page";
}
@if (TempData["Exito"] != null)
{
    <div class="alert alert-success">
        @TempData["Exito"]
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">
        @TempData["Error"]
    </div>
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Monitoreo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="~/Content/StyleIndex.css" rel="stylesheet" />
    <script src="~/Scripts/IndexScript.js"></script>
</head>
<body>
    <!-- boton de emergencia con icono  -->
    <button type="button" class="btn btn-danger rounded-circle position-fixed" style="bottom: 20px; right: 20px; z-index: 1050; width: 60px; height: 60px;" data-bs-toggle="modal" data-bs-target="#Emergencia">
        <i class="fas fa-exclamation-triangle fa-lg"></i>
    </button>
    <!-- Modal frm de emergencia -->
    <div class="modal fade" id="Emergencia" tabindex="-1" aria-labelledby="EmergenciaLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="emergenciaFrm" method="post" action="@Url.Action("GuardarEmergencia", "Home")">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title" id="formEmergenciaLabel">
                            <i class="fas fa-exclamation-triangle me-2"></i>Formulario de Emergencia
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="NombreMonitor" class="form-label">Nombre</label>
                            <input type="text" id="NombreMonitor" name="NombreMonitor" class="form-control"
                                   value="@Model.NombreMonitor" readonly />
                        </div>
                        <div class="mb-3">
                            <label for="Edificio" class="form-label">Edificio</label>
                            <select id="Edificio" name="Edificio" class="form-select" required>
                                <option value="">Seleccione un edificio</option>
                                <option value="Simon Bolivar">Simón Bolívar</option>
                                <option value="Francisco Morazan">Francisco Morazán</option>
                                <option value="Giuseppe Garibaldi">Giuseppe Garibaldi</option>
                                <option value="Benito Juárez">Benito Juárez</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="FechaHora" class="form-label">Fecha de Registro</label>
                            <input type="datetime-local" id="FechaHora" name="FechaHora" class="form-control"
                                   value="@Model.FechaHora.ToString("yyyy-MM-ddTHH:mm")" readonly required />
                        </div>
                        <div class="mb-3">
                            <label for="Comentarios" class="form-label">Comentarios</label>
                            <textarea id="Comentarios" name="Comentarios" class="form-control" rows="3" maxlength="500"
                                      placeholder="Escriba cuál es la emergencia..."></textarea>
                            <small id="comentariosHelp" class="form-text text-muted">Procure ser breve y claro.</small>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Enviar Emergencia</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="container py-4">
        <!-- Header -->
        <div class="row align-items-center mb-4">
            <div class="col-12 col-md-6 mb-3 mb-md-0">
                <h1 class="mb-0">Panel de Monitoreo</h1>
            </div>
            <div class="col-12 col-md-6">
                <div class="d-flex flex-column flex-md-row justify-content-md-end gap-2">
                    <a href="/Home/Reportes" class="btn btn-outline-primary w-100 w-md-auto mb-2 mb-md-0">
                        <i class="fas fa-file-export me-2"></i>Exportar Reporte
                    </a>
                    <a href="/Home/Filtro" class="btn btn-primary w-100 w-md-auto">
                        <i class="fas fa-plus me-2"></i>Nuevo Monitoreo
                    </a>
                </div>
            </div>
        </div>

        <!-- Metric Cards -->
        <div class="row g-4 mb-4">
            <!-- Active Systems -->
            <div class="col-12 col-sm-6 col-xl-3">
                <div class="status-card p-4">
                    <div class="d-flex align-items-center mb-3">
                        <span class="status-indicator status-active"></span>
                        <span class="metric-label">Sistemas Activos</span>
                    </div>
                    <div class="metric-value">24/25</div>
                    <div class="text-success small mt-2">
                        <i class="fas fa-arrow-up me-1"></i>99.6% Uptime
                    </div>
                </div>
            </div>

            <!-- Pending Alerts -->
            <div class="col-12 col-sm-6 col-xl-3">
                <div class="status-card p-4">
                    <div class="d-flex align-items-center mb-3">
                        <span class="status-indicator status-warning"></span>
                        <span class="metric-label">Alertas Pendientes</span>
                    </div>
                    <div class="metric-value">7</div>
                    <div class="text-warning small mt-2">
                        <i class="fas fa-clock me-1"></i>Últimas 24 horas
                    </div>
                </div>
            </div>

            <!-- Critical Incidents -->
            <div class="col-12 col-sm-6 col-xl-3">
                <div class="status-card p-4">
                    <div class="d-flex align-items-center mb-3">
                        <span class="status-indicator status-error"></span>
                        <span class="metric-label">Incidentes Críticos</span>
                    </div>
                    <div class="metric-value">2</div>
                    <div class="text-danger small mt-2">
                        <i class="fas fa-exclamation-triangle me-1"></i>Requieren atención
                    </div>
                </div>
            </div>

            <!-- Generated Reports -->
            <div class="col-12 col-sm-6 col-xl-3">
                <div class="status-card p-4">
                    <div class="d-flex align-items-center mb-3">
                        <i class="fas fa-chart-line text-primary me-2"></i>
                        <span class="metric-label">Reportes Generados</span>
                    </div>
                    <div class="metric-value" id="reporteContador">@ViewBag.TotalReportesGenerados</div>
                    <div class="text-muted small mt-2">
                        <i class="fas fa-calendar me-1"></i>Este mes
                    </div>
                </div>
            </div>

        </div>

        <!-- Main Content -->
        <div class="row g-4">
            <!-- Systems Table -->
            <div class="col-12 col-xl-8">
                <div class="status-card p-4">
                    <h2 class="h5 mb-4">Sistemas Monitoreados</h2>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Sistema</th>
                                    <th>Estado</th>
                                    <th>Última Actualización</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Servidor Principal</td>
                                    <td><span class="status-indicator status-active"></span>Activo</td>
                                    <td>Hace 5 minutos</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Ver Detalles</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Base de Datos</td>
                                    <td><span class="status-indicator status-warning"></span>Advertencia</td>
                                    <td>Hace 2 minutos</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Ver Detalles</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>API Gateway</td>
                                    <td><span class="status-indicator status-active"></span>Activo</td>
                                    <td>Hace 1 minuto</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary">Ver Detalles</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Recent Reports -->
            <div class="col-12 col-xl-4">
                <div class="status-card p-4">
                    <h2 class="h5 mb-4">Reportes Recientes</h2>
                    <div class="d-flex flex-column gap-3">
                        <a href="#" class="report-link">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Reporte Diario</h6>
                                    <small class="text-muted">15 Feb 2025</small>
                                </div>
                                <i class="fas fa-download text-primary"></i>
                            </div>
                        </a>
                        <a href="#" class="report-link">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Análisis Semanal</h6>
                                    <small class="text-muted">14 Feb 2025</small>
                                </div>
                                <i class="fas fa-download text-primary"></i>
                            </div>
                        </a>
                        <a href="#" class="report-link">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Reporte de Incidentes</h6>
                                    <small class="text-muted">13 Feb 2025</small>
                                </div>
                                <i class="fas fa-download text-primary"></i>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>

        var fechaInput = document.getElementById('fecha');

        // Cuando el modal se muestra, establecemos la fecha actual
        $('#Emergencia').on('shown.bs.modal', function () {
            fechaInput.value = new Date().toISOString().slice(0, 16); // Establecer la fecha y hora actual
        });
    </script>
</body>
</html>