@*@model List<testautenticacion.Models.MonitoreosProgramados>
    @{
        ViewBag.Title = "Reportes";
        Layout = "~/Views/Shared/_Layout.cshtml";
    }

    <h2 class="text-center mt-3">Supervisión 02-2025</h2>
    <h4 class="text-center text-muted">Informes de actividad académica</h4>*@
<!--<link href="~/Content/bootstrap.min.css" rel="stylesheet" />-->
@*<div class="container mt-4">
    <form method="get" action="@Url.Action("Reportes")">
        <div class="row">
            <div class="col-md-3">
                <label>Supervisor:</label>
                <input type="text" name="supervisor" class="form-control" value="@ViewBag.SupervisorSeleccionado">
            </div>
            <div class="col-md-3">
                <label>Docente:</label>
                <input type="text" name="docente" class="form-control" value="@ViewBag.DocenteSeleccionado">
            </div>
            <div class="col-md-2">
                <label>Aula:</label>
                <input type="text" name="aula" class="form-control" value="@ViewBag.AulaSeleccionada">
            </div>
            <div class="col-md-2">
                <label>Fecha:</label>
                <input type="date" name="fecha" class="form-control" value="@ViewBag.FechaSeleccionada">
            </div>
            <div class="col-md-2 mt-4">
                <button type="submit" class="btn btn-primary">Buscar</button>
            </div>
        </div>
    </form>

    <hr>

    <div class="row">*@
<!-- Lista de monitoreos -->
@*<div class="col-md-7">
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Materia</th>
                    <th>Docente</th>
                    <th>Aula</th>
                    <th>Fecha</th>
                    <th>Estado</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var monitoreo in Model)
                {
                    <tr>
                        <td>@monitoreo.Id</td>
                        <td>@monitoreo.Materia</td>
                        <td>@monitoreo.Docente</td>
                        <td>@monitoreo.Aula</td>
                        <td>@monitoreo.Fecha.ToString("yyyy-MM-dd")</td>
                        <td>@(monitoreo.TieneMonitoreo ? "Monitoreado" : "Pendiente")</td>
                        <td>
                            <button type="button" class="btn btn-info btn-sm ver-detalle" data-id="@monitoreo.Id">Ver</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>*@

<!-- Panel de detalle -->
@*<div class="col-md-5">
    <div id="detalle-monitoreo" class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Detalle del Monitoreo</h5>
        </div>
        <div class="card-body">
            <div id="sin-seleccion" class="text-center text-muted py-5">
                <p>Seleccione un monitoreo para ver sus detalles</p>
            </div>

            <div id="detalle-contenido" style="display: none;">*@

<!-- Detalles del Registro -->
@*<div id="registro-detalles" class="bg-light p-3 rounded">
    <h5 class="border-bottom pb-2">Detalles del Registro</h5>
    <p><strong>Fecha de registro:</strong> <span id="fecha-registro"></span></p>
    <p><strong>Estado:</strong> <span id="estado" class="badge"></span></p>
    <div class="mb-3">
        <p><strong>Comentarios:</strong></p>
        <div id="comentarios" class="border p-2 rounded"></div>
    </div>*@
<!--<div>
    <p><strong>Feedback:</strong></p>
    <div id="feedback" class="border p-2 rounded"></div>
</div>-->
@*</div>*@

<!-- Mensaje cuando no hay registro -->
@*<div id="sin-registro" class="alert alert-warning" style="display: none;">
                                <p>Este monitoreo está programado pero aún no ha sido registrado.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="@Url.Action("GenerarPDF", "Home", new {
            supervisor = ViewBag.SupervisorSeleccionado,
            docente = ViewBag.DocenteSeleccionado,
            aula = ViewBag.AulaSeleccionada,
            fecha = ViewBag.FechaSeleccionada
            })" class="btn btn-danger" id="btnGenerarReporte">Generar Reporte en PDF</a>

        </div>
    </div>*@

@*@section scripts {
    <script>
        $(document).ready(function() {
            // Click handler for the Ver button
            $('.ver-detalle').click(function() {
                var id = $(this).data('id');
                cargarDetalleMonitoreo(id);
            });

            function cargarDetalleMonitoreo(id) {
                $.ajax({
                    url: '@Url.Action("DetalleMonitoreo", "Home")',
                    type: 'GET',
                    data: { id: id },
                    dataType: 'json',
                    success: function(response) {
                        if (response.success) {
                            // Hide the "no selection" message
                            $('#sin-seleccion').hide();

                            // Fill in the monitoring schedule details
                            $('#responsable').text(response.monitoreo.responsable);
                            $('#materia').text(response.monitoreo.materia);
                            $('#docente').text(response.monitoreo.docente);
                            $('#aula').text(response.monitoreo.aula);
                            $('#fecha').text(response.monitoreo.fecha);
                            $('#hora-monitoreo').text(response.monitoreo.horaMonitoreo);
                            $('#recorrido').text(response.monitoreo.recorrido);
                            $('#jornada').text(response.monitoreo.jornada);
                            $('#ciclo').text(response.monitoreo.ciclo);

                            // Show the content div
                            $('#detalle-contenido').show();

                            if (response.tieneRegistro) {
                                // If we have registration data, show it
                                $('#fecha-registro').text(response.registro.fechaRegistro);

                                // Set state badge color
                                var estado = response.registro.estado;
                                var badgeClass = 'bg-primary';

                                if (estado === 'Todo bien') {
                                    badgeClass = 'bg-success';
                                } else if (estado === 'Nadie en el aula') {
                                    badgeClass = 'bg-primary';
                                } else if (estado === 'Cerrado') {
                                    badgeClass = 'bg-danger';
                                }

                                $('#estado').text(estado).removeClass().addClass('badge ' + badgeClass);

                                // Set comments and feedback
                                $('#comentarios').text(response.registro.comentarios || 'No hay comentarios');
                                $('#feedback').text(response.registro.feedback || 'No hay feedback');

                                // Show registration details, hide no-registration message
                                $('#registro-detalles').show();
                                $('#sin-registro').hide();
                            } else {
                                // No registration, show the message
                                $('#registro-detalles').hide();
                                $('#sin-registro').show();
                            }
                        } else {
                            alert('Error: ' + response.message);
                        }
                    },
                    error: function() {
                        alert('Error al cargar los detalles del monitoreo');
                    }
                });
            }
        });*@

@*// Cargar el valor actual al cargar la página
            fetch('/Home/ObtenerContadorReporte')
                .then(response => response.json())
                .then(data => {
                    document.getElementById("reporteContador").textContent = data.total;
                });

            // Incrementar el contador al hacer clic en el botón
            document.getElementById("btnGenerarReporte").addEventListener("click", function () {
                fetch('/Home/IncrementarContadorReporte', {
                    method: 'POST'
                })
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("reporteContador").textContent = data.total;
                    });
            });
        </script>
    }*@

@*@model List<testautenticacion.Models.MonitoreosProgramados>
    @{
        ViewBag.Title = "Reportes";
        Layout = "~/Views/Shared/_Layout.cshtml";
    }

    <h2 class="text-center mt-3">Supervisión 02-2025</h2>
    <h4 class="text-center text-muted">Informes de actividad académica</h4>

    <div class="container mt-4">
        <form method="get" action="@Url.Action("Reportes")">
            <div class="row">
                <div class="col-md-3">
                    <label>Supervisor:</label>
                    <input type="text" name="supervisor" class="form-control" value="@ViewBag.SupervisorSeleccionado">
                </div>
                <div class="col-md-3">
                    <label>Docente:</label>
                    <input type="text" name="docente" class="form-control" value="@ViewBag.DocenteSeleccionado">
                </div>
                <div class="col-md-2">
                    <label>Aula:</label>
                    <input type="text" name="aula" class="form-control" value="@ViewBag.AulaSeleccionada">
                </div>
                <div class="col-md-2">
                    <label>Fecha:</label>
                    <input type="date" name="fecha" class="form-control" value="@ViewBag.FechaSeleccionada">
                </div>
                <div class="col-md-2 mt-4">
                    <button type="submit" class="btn btn-primary">Buscar</button>
                </div>
            </div>
        </form>

        <hr>

        <div class="row">*@
<!-- Lista de monitoreos -->
@*<div class="col-md-7">
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Materia</th>
                    <th>Docente</th>
                    <th>Aula</th>
                    <th>Fecha</th>
                    <th>Estado</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var monitoreo in Model)
                {
                    <tr>
                        <td>@monitoreo.Id</td>
                        <td>@monitoreo.Materia</td>
                        <td>@monitoreo.Docente</td>
                        <td>@monitoreo.Aula</td>
                        <td>@monitoreo.Fecha.ToString("yyyy-MM-dd")</td>
                        <td>@(monitoreo.TieneMonitoreo ? "Monitoreado" : "Pendiente")</td>
                        <td>
                            <button type="button" class="btn btn-info btn-sm ver-detalle" data-id="@monitoreo.Id">Ver</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>*@

<!-- Panel de detalle -->
@*<div class="col-md-5">
    <div id="detalle-monitoreo" class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Detalle del Monitoreo</h5>
        </div>
        <div class="card-body">
            <div id="sin-seleccion" class="text-center text-muted py-5">
                <p>Seleccione un monitoreo para ver sus detalles</p>
            </div>

            <div id="detalle-contenido" style="display: none;">*@

<!-- Detalles del Registro -->
@*<div id="registro-detalles" class="bg-light p-3 rounded">
        <h5 class="border-bottom pb-2">Detalles del Registro</h5>
        <p><strong>Fecha de registro:</strong> <span id="fecha-registro"></span></p>
        <p><strong>Estado:</strong> <span id="estado" class="badge"></span></p>
        <div class="mb-3">
            <p><strong>Comentarios:</strong></p>
            <div id="comentarios" class="border p-2 rounded"></div>
        </div>
        <div>
            <p><strong>Feedback:</strong></p>
            <div id="feedback" class="border p-2 rounded"></div>
        </div>
    </div>*@

<!-- Mensaje cuando no hay registro -->
@*<div id="sin-registro" class="alert alert-warning" style="display: none;">
                                <p>Este monitoreo está programado pero aún no ha sido registrado.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="@Url.Action("GenerarPDF", "Home", new {
                    supervisor = ViewBag.SupervisorSeleccionado,
                    docente = ViewBag.DocenteSeleccionado,
                    aula = ViewBag.AulaSeleccionada,
                    fecha = ViewBag.FechaSeleccionada
                })" class="btn btn-danger">Generar Reporte en PDF</a>
        </div>
    </div>*@

@*@section scripts {
        <script>
                $(document).ready(function() {
                    // Click handler for the Ver button
                    $('.ver-detalle').click(function() {
                        var id = $(this).data('id');
                        cargarDetalleMonitoreo(id);
                    });

                    function cargarDetalleMonitoreo(id) {
                        $.ajax({
                            url: '@Url.Action("DetalleMonitoreo", "Home")',
                            type: 'GET',
                            data: { id: id },
                            dataType: 'json',
                            success: function(response) {
                                if (response.success) {
                                    // Hide the "no selection" message
                                    $('#sin-seleccion').hide();

                                    // Fill in the monitoring schedule details
                                    $('#responsable').text(response.monitoreo.responsable);
                                    $('#materia').text(response.monitoreo.materia);
                                    $('#docente').text(response.monitoreo.docente);
                                    $('#aula').text(response.monitoreo.aula);
                                    $('#fecha').text(response.monitoreo.fecha);
                                    $('#hora-monitoreo').text(response.monitoreo.horaMonitoreo);
                                    $('#recorrido').text(response.monitoreo.recorrido);
                                    $('#jornada').text(response.monitoreo.jornada);
                                    $('#ciclo').text(response.monitoreo.ciclo);

                                    // Show the content div
                                    $('#detalle-contenido').show();

                                    if (response.tieneRegistro) {
                                        // If we have registration data, show it
                                        $('#fecha-registro').text(response.registro.fechaRegistro);

                                        // Set state badge color
                                        var estado = response.registro.estado;
                                        var badgeClass = 'bg-primary';

                                        if (estado === 'Todo bien') {
                                            badgeClass = 'bg-success';
                                        } else if (estado === 'Nadie en el aula') {
                                            badgeClass = 'bg-primary';
                                        } else if (estado === 'Cerrado') {
                                            badgeClass = 'bg-danger';
                                        }

                                        $('#estado').text(estado).removeClass().addClass('badge ' + badgeClass);

                                        // Set comments and feedback
                                        $('#comentarios').text(response.registro.comentarios || 'No hay comentarios');
                                        $('#feedback').text(response.registro.feedback || 'No hay feedback');

                                        // Show registration details, hide no-registration message
                                        $('#registro-detalles').show();
                                        $('#sin-registro').hide();
                                    } else {
                                        // No registration, show the message
                                        $('#registro-detalles').hide();
                                        $('#sin-registro').show();
                                    }
                                } else {
                                    alert('Error: ' + response.message);
                                }
                            },
                            error: function() {
                                alert('Error al cargar los detalles del monitoreo');
                            }
                        });
                    }
                });
        </script>
    }*@


@model List<testautenticacion.Models.MonitoreosProgramados>

@{
    ViewBag.Title = "Reportes";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- Estilos personalizados -->
<style>
    body {
        background-color: #7b002c;
    }

    .header-container {
        background-color: #7b002c;
        padding: 1.5rem;
        border-radius: 12px;
        margin: 1.5rem auto;
        text-align: center;
        color: #fff;
    }

    .content-container {
        background-color: #fff;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }

    .btn-primary,
    .btn-info,
    .btn-danger {
        background-color: #7b0000 !important;
        border-color: #7b0000 !important;
        color: #ffffff !important;
    }

        .btn-primary:hover,
        .btn-info:hover,
        .btn-danger:hover {
            background-color: #5c0000 !important;
            border-color: #5c0000 !important;
        }

    label {
        color: #000;
    }
</style>


<div class="header-container">
    <h2 class="mb-1">Supervisión 02-2025</h2>
    <h4 class="text-light mb-0">Informes de actividad académica</h4>
</div>

<div class="content-container">
    <form method="get" action="@Url.Action("Reportes")">
        <div class="row gy-2">
            <div class="col-12 col-md-3">
                <label for="supervisor">Supervisor:</label>
                <input type="text" id="supervisor" name="supervisor" class="form-control" placeholder="Supervisor" value="@ViewBag.SupervisorSeleccionado">
            </div>
            <div class="col-12 col-md-3">
                <label for="docente">Docente:</label>
                <input type="text" id="docente" name="docente" class="form-control" placeholder="Docente" value="@ViewBag.DocenteSeleccionado">
            </div>
            <div class="col-12 col-md-2">
                <label for="aula">Aula:</label>
                <input type="text" id="aula" name="aula" class="form-control" placeholder="Aula" value="@ViewBag.AulaSeleccionada">
            </div>
            <div class="col-12 col-md-2">
                <label for="fecha">Fecha:</label>
                <input type="date" id="fecha" name="fecha" class="form-control" placeholder="Fecha" value="@ViewBag.FechaSeleccionada">
            </div>
            <div class="col-12 col-md-2 d-flex align-items-end justify-content-between">
                <a href="@Url.Action("Reportes")" class="btn btn-secondary me-1" style="flex: 0.48;">
                    <i class="fas fa-undo me-1"></i>Limpiar
                </a>
                <button type="submit" class="btn btn-primary" style="flex: 0.48;">Buscar</button>
            </div>
        </div>
    </form>

    <hr class="my-4">

    <div class="row">
        <!-- Tabla de monitoreos que ahora ocupa todo el ancho -->
        <div class="col-12">
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Materia</th>
                            <th>Docente</th>
                            <th>Aula</th>
                            <th>Fecha</th>
                            <th>Estado</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var monitoreo in Model)
                        {
                            <tr>
                                <td>@monitoreo.Id</td>
                                <td>@monitoreo.Materia</td>
                                <td>@monitoreo.Docente</td>
                                <td>@monitoreo.Aula</td>
                                <td>@monitoreo.Fecha.ToString("yyyy-MM-dd")</td>
                                <td>@(monitoreo.TieneMonitoreo ? "Monitoreado" : "Pendiente")</td>
                                <td>
                                    <button class="btn btn-sm btn-info"
                                            data-bs-toggle="tooltip"
                                            title="Ver detalles"
                                            data-monitoreo-id="@monitoreo.Id"
                                            onclick="openVisualizarModal(this)">
                                        <i class="fas fa-eye"></i> Ver
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="text-center mt-5">
                <a href="@Url.Action("GenerarPDF", "Home", new {
                    supervisor = ViewBag.SupervisorSeleccionado,
                    docente = ViewBag.DocenteSeleccionado,
                    aula = ViewBag.AulaSeleccionada,
                    fecha = ViewBag.FechaSeleccionada
                    })"
                   class="btn btn-danger">Generar Reporte en PDF</a>
                <a href="@Url.Action("GenerarCSV", "Home", new {
                    supervisor = ViewBag.SupervisorSeleccionado,
                    docente = ViewBag.DocenteSeleccionado,
                    aula = ViewBag.AulaSeleccionada,
                    fecha = ViewBag.FechaSeleccionada
                    })"
                   class="btn btn-success mt-3">Generar Reporte en CSV</a>
            </div>
        </div>
    </div>

    <!-- MODAL PARA VISUALIZAR DETALLES -->
    <div class="modal fade" id="monitoreoModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Aquí se cargará la vista parcial -->
            </div>
        </div>
    </div>
</div>

<!-- SCRIPTS NECESARIOS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

@section scripts {
    <script>
        function openVisualizarModal(button) {
            const monitoreoId = button.getAttribute('data-monitoreo-id');
            const modal = new bootstrap.Modal(document.getElementById('monitoreoModal'));

            fetch(`/Home/VerMonitoreo/${monitoreoId}`)
                .then(response => {
                    if (!response.ok) throw new Error("No se pudo cargar el detalle.");
                    return response.text();
                })
                .then(html => {
                    document.querySelector('#monitoreoModal .modal-content').innerHTML = html;
                    modal.show();
                })
                .catch(error => {
                    console.error(error);
                    alert('Ocurrió un error al cargar los detalles del monitoreo.');
                });
        }
    </script>
}