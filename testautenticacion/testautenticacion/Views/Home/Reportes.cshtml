@model List<testautenticacion.Models.MonitoreosProgramados>

@{
    ViewBag.Title = "Reportes";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- Estilos personalizados -->
<style>
/*    body {
        background-color: #7b002c;
    }*/

    .header-container {
        background-color: #7b002c;
        padding: 1.5rem;
        border-radius: 12px;
        margin: 1.5rem auto;
        text-align: center;
        color: #fff;
    }

    .content-container {
        background-color: #fff;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }

    .btn-primary,
    .btn-info,
    .btn-danger {
        background-color: #7b0000 !important;
        border-color: #7b0000 !important;
        color: #ffffff !important;
    }

        .btn-primary:hover,
        .btn-info:hover,
        .btn-danger:hover {
            background-color: #5c0000 !important;
            border-color: #5c0000 !important;
        }

    label {
        color: #000;
    }
</style>


<div class="header-container">
    <h2 class="mb-1">Supervisión 02-2025</h2>
    <h4 class="text-light mb-0">Informes de actividad académica</h4>
</div>

<div class="content-container">
    <form method="get" action="@Url.Action("Reportes")">
        <div class="row gy-2">
            <div class="col-12 col-md-3">
                <label for="supervisor">Supervisor:</label>
                <input type="text" id="supervisor" name="supervisor" class="form-control" placeholder="Supervisor" value="@ViewBag.SupervisorSeleccionado">
            </div>
            <div class="col-12 col-md-3">
                <label for="docente">Docente:</label>
                <input type="text" id="docente" name="docente" class="form-control" placeholder="Docente" value="@ViewBag.DocenteSeleccionado">
            </div>
            <div class="col-12 col-md-2">
                <label for="aula">Aula:</label>
                <input type="text" id="aula" name="aula" class="form-control" placeholder="Aula" value="@ViewBag.AulaSeleccionada">
            </div>
            <div class="col-12 col-md-2">
                <label for="fecha">Fecha:</label>
                <input type="date" id="fecha" name="fecha" class="form-control" placeholder="Fecha" value="@ViewBag.FechaSeleccionada">
            </div>
            <div class="col-12 col-md-2 d-flex align-items-end justify-content-between">
                <a href="@Url.Action("Reportes")" class="btn btn-secondary me-1" style="flex: 0.48;">
                    <i class="fas fa-undo me-1"></i>Limpiar
                </a>
                <button type="submit" class="btn btn-primary" style="flex: 0.48;">Buscar</button>
            </div>
        </div>
    </form>

    <hr class="my-4">

    <div class="row">
        <!-- Tabla de monitoreos que ahora ocupa todo el ancho -->
        <div class="col-12">
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Materia</th>
                            <th>Docente</th>
                            <th>Aula</th>
                            <th>Fecha</th>
                            <th>Estado</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var monitoreo in Model)
                        {
                            <tr>
                                <td>@monitoreo.Id</td>
                                <td>@monitoreo.Materia</td>
                                <td>@monitoreo.Docente</td>
                                <td>@monitoreo.Aula</td>
                                <td>@monitoreo.Fecha.ToString("yyyy-MM-dd")</td>
                                <td>@(monitoreo.TieneMonitoreo ? "Monitoreado" : "Pendiente")</td>
                                <td>
                                    <button class="btn btn-sm btn-info"
                                            data-bs-toggle="tooltip"
                                            title="Ver detalles"
                                            data-monitoreo-id="@monitoreo.Id"
                                            onclick="openVisualizarModal(this)">
                                        <i class="fas fa-eye"></i> Ver
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            <div class="d-flex justify-content-center gap-3 mt-3">
                <a href="@Url.Action("GenerarPDF", "Home", new {
                        supervisor = ViewBag.SupervisorSeleccionado,
                        docente = ViewBag.DocenteSeleccionado,
                        aula = ViewBag.AulaSeleccionada,
                        fecha = ViewBag.FechaSeleccionada
                        })"
                   class="btn btn-danger">
                    Generar Reporte en PDF
                </a>

                <a href="@Url.Action("GenerarCSV", "Home", new {
                        supervisor = ViewBag.SupervisorSeleccionado,
                        docente = ViewBag.DocenteSeleccionado,
                        aula = ViewBag.AulaSeleccionada,
                        fecha = ViewBag.FechaSeleccionada
                    })"
                   class="btn btn-success">
                    Generar Reporte en CSV
                </a>
            </div>

        </div>

        <!-- MODAL PARA VISUALIZAR DETALLES -->
        <div class="modal fade" id="monitoreoModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <!-- Aquí se cargará la vista parcial -->
                </div>
            </div>
        </div>
    </div>

<!-- SCRIPTS NECESARIOS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

@section scripts {
    <script>
        function openVisualizarModal(button) {
            const monitoreoId = button.getAttribute('data-monitoreo-id');
            const modal = new bootstrap.Modal(document.getElementById('monitoreoModal'));

            fetch(`/Home/VerMonitoreo/${monitoreoId}`)
                .then(response => {
                    if (!response.ok) throw new Error("No se pudo cargar el detalle.");
                    return response.text();
                })
                .then(html => {
                    document.querySelector('#monitoreoModal .modal-content').innerHTML = html;
                    modal.show();
                })
                .catch(error => {
                    console.error(error);
                    alert('Ocurrió un error al cargar los detalles del monitoreo.');
                });
        }
    </script>
}